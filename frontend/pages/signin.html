<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Create account â€” To-Do</title>
    <link rel="stylesheet" href="../styles/style.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
    <div class="container col-6 mt-5">
        <div class="card shadow-sm">
            <div class="card-body">
                <h3 class="card-title mb-3">Create account</h3>
                <form id="signupForm" novalidate>
                    <div class="mb-3">
                        <label for="name" class="form-label">Name</label>
                        <input id="name" class="form-control" type="text" required />
                    </div>
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input id="email" class="form-control" type="email" required />
                    </div>
                    <div class="mb-3 row">
                        <div class="col">
                            <label for="password" class="form-label">Password</label>
                            <input id="password" class="form-control" type="password" required />
                        </div>
                        <div class="col">
                            <label for="confirm" class="form-label">Confirm</label>
                            <input id="confirm" class="form-control" type="password" required />
                        </div>
                    </div>
                    <div id="signupAlert" class="alert d-none" role="alert"></div>
                    <div class="d-flex justify-content-between align-items-center">
                        <button class="btn btn-primary" type="submit">Create account</button>
                        <a href="login.html">Already have an account?</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
    (function(){
        const form = document.getElementById('signupForm');
        const alertEl = document.getElementById('signupAlert');

        function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,8); }
        function loadUsers(){ try { return JSON.parse(localStorage.getItem('users')||'[]'); } catch { return []; } }
        function saveUsers(u){ localStorage.setItem('users', JSON.stringify(u)); }
        function showAlert(msg, type='danger'){ alertEl.className = 'alert alert-' + type; alertEl.textContent = msg; alertEl.classList.remove('d-none'); }
        function hideAlert(){ alertEl.className = 'alert d-none'; alertEl.textContent = ''; }

        form.addEventListener('submit', function(e){
            e.preventDefault();
            hideAlert();
            const name = document.getElementById('name').value.trim();
            const email = (document.getElementById('email').value || '').trim().toLowerCase();
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirm').value;

            if(!name || !email || !password || !confirm){ showAlert('All fields are required.'); return; }
            if(password !== confirm){ showAlert('Passwords do not match.'); return; }

            const users = loadUsers();
            if(users.some(u => (u.email||'').toLowerCase() === email)){ showAlert('An account with that email already exists.'); return; }

            // store password as base64 to avoid plain-text visible in UI (not secure for real apps)
            const user = { id: uid(), name, email, password: btoa(password) };
            users.push(user);
            saveUsers(users);

            localStorage.setItem('currentUser', JSON.stringify({id:user.id, name:user.name, email:user.email}));
            showAlert('Account created. Redirecting...', 'success');
            setTimeout(()=> location.href = 'index.html', 700);
        });
    })();
    </script>
</body>
</html>